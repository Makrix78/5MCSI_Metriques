<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Analyse des commits GitHub</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        padding: 40px;
        color: #333;
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
      }

      #chart_div {
        width: 100%;
        max-width: 1000px;
        height: 500px;
        margin: auto;
      }

      .description {
        max-width: 800px;
        margin: auto;
        text-align: center;
        margin-bottom: 40px;
        font-size: 16px;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <h2>Répartition des Commits par Minute</h2>

    <div class="description">
      Ce graphique représente le nombre de commits effectués sur le projet
      <b>OpenRSI/5MCSI_Metriques</b>, regroupés par minute de la journée (exemple : 13:00, 13:01, 13:02...).
      Il permet d’analyser l’activité des développeurs dans le temps.
    </div>

    <div id="chart_div"></div>

    <script>
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        fetch('/commits/')
          .then(response => response.json())
          .then(data => {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Minute');
            dataTable.addColumn('number', 'Nombre de commits');

            data.results.forEach(entry => {
              dataTable.addRow([entry.minute.toString().padStart(2, '0'), entry.commits]);
            });

            const options = {
              title: 'Nombre de commits par minute (0 à 59)',
              hAxis: {
                title: 'Minute de l\'heure',
                titleTextStyle: { bold: true },
                textStyle: { fontSize: 12 }
              },
              vAxis: {
                title: 'Nombre de commits',
                titleTextStyle: { bold: true },
                minValue: 0
              },
              legend: 'none',
              colors: ['#1f77b4'],
              bar: { groupWidth: '80%' }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
          });
      }
    </script>
  </body>
</html>
